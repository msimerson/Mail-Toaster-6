image: auchida/freebsd:latest

before_script:
  - sudo pkg update && sudo pkg install -y ca_root_nss

test:
  script:
    - sh test/get_jail_ip.sh
    - echo "export TOASTER_HOSTNAME=`hostname`" >> mail-toaster.conf
    - echo "export TOASTER_MAIL_DOMAIN=`hostname`" >> mail-toaster.conf
    - sh provision-host.sh
    - sh provision-base.sh
    - sh provision-dns.sh
    - sh provision-mysql.sh
    - sh provision-redis.sh
    - sh provision-clamav.sh
    - sh provision-rspamd.sh
    - sh provision-vpopmail.sh
    - sh provision-dovecot.sh
    - sh provision-geoip.sh
    - sh provision-haraka.sh
    - sh provision-haproxy.sh
    - sh provision-webmail.sh
    - sh provision-roundcube.sh
    - sh provision-rainloop.sh
    - sh provision-squirrelmail.sh
    - sh provision-spamassassin.sh
  tags:
    - freebsd
    - ssh


# Test Runner Setup Instructions
# 1. Create a new FreeBSD VM, 4GB RAM, 15GB+ Disk
# 2. sed -i'' 'm/^bind Sp/ s/^b/#b/' /root/.bash_profile
# 3. pkg update && pkg install -y git-lite open-vm-tools-nox11
# 4. install ~/.ssh/authorized_keys & /root/.ssh/authorized_keys
# 5. sed -i'' 's/^#PermitRoot.*/PermitRootLogin without-password/'
# 6. freebsd-update fetch install
# 7. portsnap fetch extract
# 8. halt -p now && take a snapshot